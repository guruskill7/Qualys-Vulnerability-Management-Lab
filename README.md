## **Qualys Essentials: Vulnerability Management Lab** ##

### **Description** ###   
This is a walkthrough of how I created A Virtual Machine environment using VMWare ESXi. In this virtual environment, I created  Windows 10 and Windows 7.      
I did this project to gain experience with Qualys and learn how to scan for vulnerabilities and remediate them. This project will showcase Some of the steps of the Vulnerability Management Lifecycle.    
I will use Qualys to scan local VMs hosted on VMWare ESXi to discover vulnerabilities, remediate some vulnerabilities, and then perform a rescan to verify remediation.   

#### Quick disclaimer: #### 
Please do not scan a network you do not have explicit permission to scan.     
Unauthorized activity like this can result in serious legal consequences.    
So, only scan your home network.   

##### **Utilities Used** #####    
* Qualys Community Edition   
* CMD

##### **Environments Used** #####    
* VMWare ESXi   
* Windows 10 Pro Version 1709   
* Windows 7 Ultimate (Service Pack 1)   
##### **Links** #####
* Qualys Community Edition:
     * [Qualys Community Edition | Qualys](https://www.qualys.com/community-edition/)     
* VMWare ESXi:   
    * [Download the ESXi Installer (vmware.com)](https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.esxi.install.doc/GUID-016E39C1-E8DB-486A-A235-55CAB242C351.html)    
* Windows 10 Installation:    
    * https://www.microsoft.com/en-us/software-download/windows10      
* Windows 7 Ultimate (Service Pack 1)    
    * https://support.microsoft.com/en-us/windows/install-windows-7-service-pack-1-sp1-b3da2c0f-cdb6-0572-8596-bab972897f61      
        * https://www.catalog.update.microsoft.com/Search.aspx?q=KB976932     

#### **Program walk-through** ####      
The first thing I am going to do is Download and install VMware ESXi. Then download and install  Windows 10 Pro and Windows 7.     
Next, I am going to download and install Qualys Community Edition. You will need a work or school email to do so.     

![Screenshot 2024-02-14 221403](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/2a7b5c97-9f46-4fe4-9683-d14102ea0d03)      

##### Notes About this Edition #####     
Qualys Community Edition gives you these great capabilities at no cost:    
* Monitor up to 16 assets with Qualys Cloud Agent     
* Scan up to 16 internal and 3 external IPs with Vulnerability Management    
* Scan 1 URL with Web Application Scanning.    
* Deploy a Virtual Scanner Appliance within your internal network.    
* Gain visibility within your cloud environments.     
* Generate reports and assess results quickly and easily.    

**`If you follow the instructions properly you will receive a URL link to the Qualys Cloud Dashboard with credentials and instructions on how to access it`.**     

![Screenshot 2024-02-14 224735](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/03acfad8-fde3-43b6-accb-1060429dfe18)      

**`Once you get to the page below, configure and download the virtual appliance`**     

![Screenshot 2024-02-18 212515-4](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/2771fb05-8583-4465-8333-28f0056d4a1d)     


**`Next, click on Start Wizard and follow the instructions`.**     

![Screenshot 2024-02-18 212851-41](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/e8e21cee-cea8-494f-92a8-4c0484d4535f)      
![Screenshot 2024-02-14 230402](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/8a930386-5b8e-440b-b0e4-01e358519317)     

Click next and follow the instructions. Make sure to copy and save your Personalization Code. Configure your scanner and activate it using the **`personalization code`.**       
Once you are done installing the Virtual Appliance in VMware ESXi, launch it. The main screen should ask for the **`Personalization Code`.**     

![Screenshot 2024-02-14 231932](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/c473565a-e0bc-4ba7-b57a-4995958fbd87)    

Once you see the screen above, hit enter to get to the page where you need to enter the code. Use the up and down arrow to navigate the menu    

![Screenshot 2024-02-14 232609](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/88c24f8b-142c-47c1-acb0-7ef3abf93a42)     

Once it finishes installing you will see the display of the private IP the Virtual appliance will use.    
Then go back to the page where you got your personalization code and click on **`Check Activation`.**     

![Screenshot 2024-02-14 233222](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/cfdc25ca-7239-4c2d-8f24-9c54010aee16)     

Here is it going to verify that your appliance is active and running.    

![Screenshot 2024-02-14 233557](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/987736f8-3451-4b26-ade0-c3d3dd7a12a1)    

If it is successfully set up and connected, you will see your appliance under the **`Appliances`** tab in the Qualys Web Dashboard.     

![Screenshot 2024-02-14 233832](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/235781a3-a9e2-4c11-83a2-5f99017974cf)    

Next, We need to select the IP range that Qualys will be scanning. While in the  Qualys Cloud Dashboard, click on Assets and then on **`Add IPs for Scanning`**    

![Screenshot 2024-02-14 234052](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/7785d457-4581-4a85-9e4d-44e48a3219a5)     


Next, click on New then click on **`IP Tracked Addresses`**    

![Screenshot 2024-02-14 234148](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/067d446d-d327-4842-ade5-8b0847a446b8)      

Next, go to subscription IPs and enter the IPs range you want to scan.    

Ensure the Windows 10 Pro host is within the scanning range initially configured. Otherwise, you can manually assign a static IP to the machine within the scanning range. ( **`Window 10 Pro —> Network and Internet —> Network and Sharing Center —> Ethernet —> Properties —> Internet Protocol Version 4 (TCP/IPv4)) —> Properties —> Use the following IP address:`**) [You can ping the host from your main computer to make sure the IP assigned is working ]     

While you are on a Windows 10 Pro machine, make sure the firewall is not going to block the scanner's IP. Since it is a built-in device firewall, I would simply just turn it off for this lab.     
( We are disabling the firewall mainly for this lab. Otherwise, in a professional environment, this would not be recommended)     

**`Window 10 —> Search and click on: Windows Defender Firewall —> Turn Window Defender Firewall On or Off —> OK`**    

![Screenshot 2024-02-18 214839-12](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/aade343d-d098-4793-ba24-880742b48d03)      

Turn off the built-in Firewall on Windows 7  as well.    
Now we are ready to scan the host. Go back to Qualys Cloud Dashboard, click on **`Scans`**, then on **`Option Profiles`** then select **`New`** and **`Option Profile`**. Provide a name to the scan     

![Screenshot 2024-02-15 001441](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/e2be36a9-96c3-48e6-895d-5d45f4cd2508)     

On the same page click on **`Scan`** below **`Option Profile Title`**. Next, let’s set up authentication for the scan. To make sure our scanner can access the registry, we need to make some adjustments on our  Windows machines.        

**`On Windows, go to Services —> Remote Registry —-> Properties —> Startup Type = Automatic —> Apply → Ok.`**     

![Screenshot 2024-02-15 104259](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/1f306122-a85c-4f63-93b4-4afd698dd987)      

**`Remote Registry —> Right-click → Start`**    

After that, within Services still:  **`Server —> Properties —>  Startup Type = Automatic —> Apply → OK`**. Then start it as well     
Next, go to **`Control Panel —> Network and Internet —> Network and Sharing Center —> Advanced sharing settings`**.    
Make sure **“Turn on network discovery”** and **“Turn on file and printer sharing”** are selected.    

![Screenshot 2024-02-15 105110](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/1562ca6e-ee24-4301-a889-b38833d98aaf)     

**Go to User Account Control Settings and change it to never notify**    

![Screenshot 2024-02-15 105309](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/b3f152a3-6fa1-424a-bd77-68eb52ec5cc0)      

**Make these changes in Registry Editor:**     

**`Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`**     
Then right-click → **`New → Key → DWORD (32-bit) value. Value name = FilterPolicy TokenLocalAccount. Value data = 1`**     

![Screenshot 2024-02-15 165409](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/9e192ecb-cf3d-4b16-ab08-c9a9fa6fec87)      

Make sure you have some user profiles created in the machine that we will use for the authentication scan. For this lab, I have created 2 users with simple passwords.       

![Screenshot 2024-02-15 171010](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/62610f22-e832-463e-b194-8334d5afdfd5)     

**The machines are now ready for scan.**        
Go back to Qualys and click on **`Authentication → New —> Operating System → Windows`**     

![Screenshot 2024-02-15 165805](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/2252e597-aab8-4fe4-86ee-894f18f32695)      

**Provide a name and login Credentials and the host IP you are running a credential scan against.**         

![Screenshot 2024-02-15 170039](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/da294e64-4625-4558-a1be-e97e9ad710db)     
![Screenshot 2024-02-15 171238](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/20defaf2-8689-44fb-ba99-10c665f8361f)     
![Screenshot 2024-02-15 171425](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/9c6f7859-1434-4d56-9e23-eaa9a9278578)     

Now go back to **`Option Profiles`** in Qualys, click on the profile you created earlier, and make sure **`“Windows”`** is selected under **`Authentication`**. Hit Save.     

![Screenshot 2024-02-15 173228](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/41d9552c-bad6-4c1b-94a4-42983e42022b)      
![Screenshot 2024-02-18 22145265](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/27a39707-797d-4b5e-894d-59dc01a344f1)      

Click Save, go to Scans, and then click New and Scan. Give it a title of your choice. In Option Profile, select the one we created previously. In Processing Priority, leave it unchanged **(0 - No Priority)**.     
Scanner Appliance, select the appliance (virtual scanner) initially created. Under IPv4 Addresses/Ranges, you can provide the IP of the devices you want to scan. Then hit Launch     

![Screenshot 2024-02-15 002849](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/7e41ea01-7e80-4427-ae29-3e8b02ea66f3)       

**We now just have to wait for the scan to complete.**     

![Screenshot 2024-02-15 175922](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/f76c0b18-2a02-4f81-ad23-3cb65c127505)      

#### **Scan results:** ####     

![Screenshot 2024-02-15 180048](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/0c4713be-2d4e-40f8-97df-ed15f1df3a59)       
![Screenshot 2024-02-15 193810](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/e596a42f-1367-42ef-ab93-b712152ea06b)      
![Screenshot 2024-02-15 193922](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/d566d917-bb17-4624-8cf0-e9f7084be2f5)      
![Screenshot 2024-02-15 194204](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/ca2545d9-ab6c-4a8f-bcb6-9623d2dac5ac)      
![Screenshot 2024-02-15 194738](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/7eff4c3a-630c-465b-a62e-15b97c466010)       

### **Remediation of a few vulnerabilities:** ###     
On both devices, let’s resolve some vulnerabilities including the one circled in red in the screenshot below.      

![Screenshot 2024-02-18 2231395566](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/25f3f60e-ad81-4bc2-b2e4-d74d3072a7be)       

**Let’s rescan the host after remediation.     
You can see from the result below that some of the vulnerabilities detected previously are no longer showing up on the hosts after being rescanned. We went from 93 vulnerabilities to 61 after mitigation and  
rescan.**     

![Screenshot 2024-02-15 215300](https://github.com/guruskill7/Vulnerability-Management/assets/112531176/dfa1eebc-db99-40a4-b2c4-e5448e8b8a0f)     





